# pipelines/silver_contas.yaml
pipeline_type: "silver"
pipeline_name: "silver_contas"
description: "Ingere dados de contas de um diretório, aplica qualidade e padronização."

# Configuração da fonte, agora com suporte ao Auto Loader para processamento incremental
source:
  format: "csv" # Usando Auto Loader do Databricks
  options:
    header: "true"
    delimiter: ";"
  expected_columns: 53 # O número de colunas que o arquivo DEVE ter
  path: "/Volumes/dev/sch_bronze/testes/TESTE.csv" # Padrão de caminho para os arquivos


# Destino dos dados processados
sink:
  catalog: "dev"
  schema: "sch_silver"
  table: "teste"
  mode: "append" # Geralmente 'append' para dados incrementais
  # zorder_by: ["ColunaA"] # Opcional: otimização de performance

defaults:
  date_format: "dd/MM/yyyy" # Formato de data padrão para todo o pipeline
  column_rename_pattern: "snake_case" # Opções: "snake_case" ou "none"

# Definição detalhada das colunas e transformações
columns:
  - name: "ColunaA"
    rename: "coluna_a"
    type: "string"
    description: "Coluna a"
    pk: true # Indica que é parte da chave primária
    validate:
      - "not_null"

  - name: "ColunaB"
    rename: "coluna_b"
    type: "double"
    description: "Coluna B"
    validate:
      - "not_null"

  # - name: "ColunaC"
  #   rename: "coluna_c"
  #   type: "date"
  #   description: "Coluna C"
  #   transform: "UPPER(TRIM(ColunaC))" # Aplica transformações SQL
  #   validate:
  #     - "isin:['CORRENTE', 'POUPANCA']" # Valida se o valor está em uma lista

  # - name: "balance"
  #   rename: "saldo"
  #   type: "decimal(18, 2)"
  #   description: "Saldo atual da conta."
  #   validate:
  #     - "greater_than_or_equal_to:0" # Validação de intervalo

  - name: "ColunaC"
    rename: "coluna_c"
    type: "date"
    format: "dd/mm/yyy" # Formato original para parsing correto
    description: "Data Coluna C"

# Configuração de agendamento (informativo, para ser usado pelo Databricks Jobs)
schedule:
  type: "triggered" # 'triggered' ou 'cron'
  cron_expression: "0 0 5 * * ?" # Exemplo: todo dia às 5h da manhã

# Opcional: permite usar um notebook customizado em vez do motor padrão
custom_script_override: "" # Ex: "/Repos/seu_usuario/custom_scripts/processa_contas.py"
